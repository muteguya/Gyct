<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CIUE · Admin Panel</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background: #f0f2f5;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Admin Header */
    .admin-header {
      background: linear-gradient(135deg, #7d5ba6, #b8a3d9);
      color: white;
      padding: 25px;
      border-radius: 20px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 10px 25px rgba(125,91,166,0.3);
    }

    .admin-header h1 {
      font-size: 2rem;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .admin-header h1 i {
      font-size: 2.5rem;
    }

    .admin-header .stats {
      background: rgba(255,255,255,0.2);
      padding: 12px 25px;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
    }

    /* Login Form */
    .login-container {
      max-width: 400px;
      margin: 50px auto;
      background: white;
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.1);
      text-align: center;
    }

    .login-container h2 {
      color: #4a3b5e;
      margin-bottom: 30px;
      font-size: 1.8rem;
    }

    .login-container .input-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .login-container label {
      display: block;
      color: #4a3b5e;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .login-container input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e0d0eb;
      border-radius: 15px;
      font-size: 1rem;
      outline: none;
    }

    .login-container input:focus {
      border-color: #7d5ba6;
    }

    .login-btn {
      background: linear-gradient(135deg, #7d5ba6, #b8a3d9);
      color: white;
      border: none;
      width: 100%;
      padding: 15px;
      border-radius: 15px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(125,91,166,0.3);
    }

    .error-message {
      color: #dc3545;
      margin-top: 15px;
      font-size: 0.9rem;
      display: none;
    }

    /* Admin Dashboard */
    .admin-dashboard {
      display: none;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .stat-icon.pending {
      background: #fff3cd;
      color: #856404;
    }

    .stat-icon.approved {
      background: #d4edda;
      color: #155724;
    }

    .stat-icon.total {
      background: #e6f7ff;
      color: #0066cc;
    }

    .stat-info h3 {
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 5px;
    }

    .stat-info .number {
      font-size: 2rem;
      font-weight: 700;
      color: #333;
    }

    /* Deposits Table */
    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-title h2 {
      color: #4a3b5e;
      font-size: 1.5rem;
    }

    .refresh-btn {
      background: #7d5ba6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }

    .refresh-btn:hover {
      background: #6a4b8f;
    }

    .table-container {
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 15px 10px;
      background: #f8f9fa;
      color: #4a3b5e;
      font-weight: 600;
      font-size: 0.9rem;
    }

    td {
      padding: 15px 10px;
      border-bottom: 1px solid #eaeaea;
    }

    .status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-approved {
      background: #d4edda;
      color: #155724;
    }

    .status-rejected {
      background: #f8d7da;
      color: #721c24;
    }

    .action-btns {
      display: flex;
      gap: 8px;
    }

    .approve-btn, .reject-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .approve-btn {
      background: #28a745;
      color: white;
    }

    .approve-btn:hover {
      background: #218838;
    }

    .reject-btn {
      background: #dc3545;
      color: white;
    }

    .reject-btn:hover {
      background: #c82333;
    }

    .no-data {
      text-align: center;
      padding: 40px;
      color: #999;
      font-style: italic;
    }

    /* Logout Button */
    .logout-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.5);
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      max-width: 400px;
      width: 90%;
      border-radius: 20px;
      padding: 30px;
      text-align: center;
    }

    .modal-content h3 {
      color: #4a3b5e;
      margin-bottom: 15px;
      font-size: 1.5rem;
    }

    .modal-content p {
      color: #666;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .modal-btns {
      display: flex;
      gap: 10px;
    }

    .confirm-btn, .cancel-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    .confirm-btn {
      background: #28a745;
      color: white;
    }

    .confirm-btn:hover {
      background: #218838;
    }

    .cancel-btn {
      background: #6c757d;
      color: white;
    }

    .cancel-btn:hover {
      background: #5a6268;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Login Section -->
    <div id="loginSection" class="login-container">
      <h2><i class="fas fa-crown" style="color: #7d5ba6;"></i> Admin Login</h2>
      <div class="input-group">
        <label>Username</label>
        <input type="text" id="adminUsername" placeholder="Enter admin username">
      </div>
      <div class="input-group">
        <label>Password</label>
        <input type="password" id="adminPassword" placeholder="Enter admin password">
      </div>
      <button class="login-btn" onclick="adminLogin()">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>
      <div id="loginError" class="error-message">Invalid credentials</div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard">
      <!-- Header -->
      <div class="admin-header">
        <h1>
          <i class="fas fa-crown"></i>
          CIUE Admin Panel
        </h1>
        <div style="display: flex; gap: 15px; align-items: center;">
          <span class="stats" id="pendingCount">Pending: 0</span>
          <button class="logout-btn" onclick="adminLogout()">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon pending">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-info">
            <h3>Pending Deposits</h3>
            <div class="number" id="statPending">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon approved">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-info">
            <h3>Approved Today</h3>
            <div class="number" id="statApproved">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon total">
            <i class="fas fa-coins"></i>
          </div>
          <div class="stat-info">
            <h3>Total Deposits</h3>
            <div class="number" id="statTotal">0</div>
          </div>
        </div>
      </div>

      <!-- Deposits Table -->
      <div class="section-title">
        <h2><i class="fas fa-history"></i> Deposit Requests</h2>
        <button class="refresh-btn" onclick="loadPendingDeposits()">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>

      <div class="table-container">
        <table id="depositsTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>User</th>
              <th>Phone</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="depositsBody">
            <tr>
              <td colspan="6" class="no-data">No deposit requests found</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">Confirm Approval</h3>
      <p id="modalMessage">Are you sure you want to approve this deposit?</p>
      <div class="modal-btns">
        <button class="confirm-btn" id="modalConfirmBtn" onclick="executeAction()">Yes, Approve</button>
        <button class="cancel-btn" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // ========== ADMIN CREDENTIALS ==========
    const ADMIN_USERNAME = 'admin';
    const ADMIN_PASSWORD = 'admin123';

    // ========== GLOBAL VARIABLES ==========
    let pendingAction = null;
    let selectedDepositId = null;

    // ========== LOGIN FUNCTION ==========
    function adminLogin() {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        // Login successful
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('adminDashboard').style.display = 'block';
        document.getElementById('loginError').style.display = 'none';
        
        // Load data
        loadPendingDeposits();
      } else {
        // Login failed
        document.getElementById('loginError').style.display = 'block';
      }
    }

    // ========== LOGOUT FUNCTION ==========
    function adminLogout() {
      document.getElementById('loginSection').style.display = 'block';
      document.getElementById('adminDashboard').style.display = 'none';
      document.getElementById('adminUsername').value = '';
      document.getElementById('adminPassword').value = '';
    }

    // ========== LOAD PENDING DEPOSITS ==========
    function loadPendingDeposits() {
      // Get data from localStorage
      const users = JSON.parse(localStorage.getItem('cueUsers')) || {};
      const pendingDeposits = JSON.parse(localStorage.getItem('pendingDeposits')) || [];
      
      // Update stats
      updateStats(pendingDeposits);
      
      // Display deposits
      displayDeposits(pendingDeposits, users);
    }

    // ========== UPDATE STATISTICS ==========
    function updateStats(deposits) {
      const pending = deposits.filter(d => d.status === 'pending').length;
      
      // Get today's date
      const today = new Date().toDateString();
      const approvedToday = deposits.filter(d => 
        d.status === 'approved' && new Date(d.timestamp).toDateString() === today
      ).length;
      
      document.getElementById('statPending').textContent = pending;
      document.getElementById('statApproved').textContent = approvedToday;
      document.getElementById('statTotal').textContent = deposits.length;
      document.getElementById('pendingCount').textContent = `Pending: ${pending}`;
    }

    // ========== DISPLAY DEPOSITS TABLE ==========
    function displayDeposits(deposits, users) {
      const tbody = document.getElementById('depositsBody');
      
      if (deposits.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">No deposit requests found</td></tr>';
        return;
      }

      let html = '';
      
      // Sort by date (newest first)
      deposits.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      deposits.forEach(deposit => {
        const user = users[deposit.userId] || { fullName: 'Unknown', phone: 'Unknown' };
        const date = new Date(deposit.timestamp).toLocaleString();
        const statusClass = deposit.status === 'pending' ? 'status-pending' : 
                           deposit.status === 'approved' ? 'status-approved' : 'status-rejected';
        const statusText = deposit.status ? deposit.status.toUpperCase() : 'PENDING';
        
        html += `
          <tr>
            <td>${date}</td>
            <td>${user.fullName || 'Unknown'}</td>
            <td>${user.phone || deposit.phone || 'Unknown'}</td>
            <td><strong>${deposit.amount?.toLocaleString() || 0} UGX</strong></td>
            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
            <td>
        `;
        
        if (!deposit.status || deposit.status === 'pending') {
          html += `
              <div class="action-btns">
                <button class="approve-btn" onclick="openApproveModal('${deposit.id}')">
                  <i class="fas fa-check"></i> Approve
                </button>
                <button class="reject-btn" onclick="openRejectModal('${deposit.id}')">
                  <i class="fas fa-times"></i> Reject
                </button>
              </div>
          `;
        } else {
          html += `<span style="color: #999;">No action</span>`;
        }
        
        html += `</td></tr>`;
      });
      
      tbody.innerHTML = html;
    }

    // ========== MODAL FUNCTIONS ==========
    function openApproveModal(depositId) {
      selectedDepositId = depositId;
      pendingAction = 'approve';
      document.getElementById('modalTitle').textContent = 'Confirm Approval';
      document.getElementById('modalMessage').textContent = 'Are you sure you want to approve this deposit? The amount will be added to user\'s Operating Wallet.';
      document.getElementById('modalConfirmBtn').textContent = 'Yes, Approve';
      document.getElementById('confirmModal').style.display = 'flex';
    }

    function openRejectModal(depositId) {
      selectedDepositId = depositId;
      pendingAction = 'reject';
      document.getElementById('modalTitle').textContent = 'Confirm Rejection';
      document.getElementById('modalMessage').textContent = 'Are you sure you want to reject this deposit?';
      document.getElementById('modalConfirmBtn').textContent = 'Yes, Reject';
      document.getElementById('confirmModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('confirmModal').style.display = 'none';
      pendingAction = null;
      selectedDepositId = null;
    }

    // ========== EXECUTE ACTION (APPROVE/REJECT) ==========
    function executeAction() {
      if (!selectedDepositId || !pendingAction) return;
      
      // Get data
      let pendingDeposits = JSON.parse(localStorage.getItem('pendingDeposits')) || [];
      const users = JSON.parse(localStorage.getItem('cueUsers')) || {};
      
      // Find the deposit
      const depositIndex = pendingDeposits.findIndex(d => d.id == selectedDepositId);
      
      if (depositIndex !== -1) {
        const deposit = pendingDeposits[depositIndex];
        
        if (pendingAction === 'approve') {
          // Update status
          deposit.status = 'approved';
          
          // Add money to user's operating wallet
          if (users[deposit.userId]) {
            users[deposit.userId].operatingWallet = (users[deposit.userId].operatingWallet || 0) + deposit.amount;
          }
          
          alert(`✅ Deposit of ${deposit.amount?.toLocaleString()} UGX approved and added to user's wallet`);
        } else {
          // Update status to rejected
          deposit.status = 'rejected';
          alert(`❌ Deposit rejected`);
        }
        
        // Save changes
        pendingDeposits[depositIndex] = deposit;
        localStorage.setItem('pendingDeposits', JSON.stringify(pendingDeposits));
        localStorage.setItem('cueUsers', JSON.stringify(users));
        
        // Reload table
        loadPendingDeposits();
      }
      
      closeModal();
    }

    // ========== CHECK IF USER IS LOGGED IN (OPTIONAL) ==========
    window.onload = function() {
      // You can add auto-login for development
      // adminLogin();
    }
  </script>
</body>
</html>